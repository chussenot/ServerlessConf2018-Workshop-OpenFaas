---

- set_fact:
    master_ip_address: "{{ master_ip_address_configured }}"
  when: master_ip_address_configured is defined
- set_fact:
    master_ip_address: "{{ ansible_default_ipv4['address'] }}"
  when: master_ip_address_configured is not defined
- name: Save master_ip_address
  shell: "echo master_ip_address{{ ':' }} {{ master_ip_address }} > cfg/{{ cluster_name }}/master_ip_address.yml"
  delegate_to: 127.0.0.1
  become: false

- name: Initialize master
  command: kubeadm init --token {{ token }}
  register: master_init
  ignore_errors: true
  tags:
    - master
    - init
